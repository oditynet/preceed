Скрипт преследует три основные цели: прописать файл interfaces, убрать 'net.ifnames=0' из параметров GRUB, чтобы сетевые интерфейсы не назывались eth0, eth1, и т.д., и включить службы по необходимости.

Файл interfaces можно генерировать последовательностью команд echo, а можно просто подтянуть с сервера. Можно, опять же, попытаться шаблонизировать файл interfaces, используя sed, но, во-первых, это сильно усложняет и без того комплексную схему, а во-вторых, по непонятной причине на физическом хосте эта шаблонизация не отработала должным образом. Так что, проще подтягивать готовый interfaces. Универсального решения здесь, к сожалению, нет.
Из скрипта видно, что скачивается и устанавливается firstboot.service. По невыясненным причинам, эта часть так же не сработала. Доведение до ума этой функции решено отложить.
#!/bin/sh
MIRROR=192.168.130.11
#ETHDEV=$(ip -o l | cut -d ' ' -f 2 | cut -d: -f 1 | tail -n 1)
#echo "# GENERATED BY PRESEED The loopback network interface" > /target/etc/network/interfaces
#echo "auto lo" >> /target/etc/network/interfaces
#echo "iface lo inet loopback" >> /target/etc/network/interfaces
#echo "" >> /target/etc/network/interfaces
#echo "# The primary network interface" >> /target/etc/network/interfaces
#echo "auto ${ETHDEV}" >> /target/etc/network/interfaces
#echo "allow-hotplug ${ETHDEV}" >> /target/etc/network/interfaces
#echo "iface ${ETHDEV} inet dhcp" >> /target/etc/network/interfaces
#
# add repo for auto update at firstboot
echo "deb ftp://${MIRROR}/iso/1.7.2-update-uu1 1.7_x86-64 main non-free contrib" >> /target/etc/apt/sources.list
#wget -O /tmp/firstboot.service ftp://${MIRROR}/scripts/firstboot.service
#cp /tmp/firstboot.service /target/etc/systemd/system/firstboot.service
#in-target systemctl enable firstbooot.service
#
# remove net.ifnames, update grub
sed -i 's/net.ifnames=0//g' /target/etc/default/grub
in-target update-grub
in-target systemctl enable ssh.service
#
# update interfaces
wget -O /tmp/interfaces ftp://${MIRROR}/scripts/interfaces_ph_v1
#wget -O /tmp/render_interfaces.sh ftp://${MIRROR}/scripts/render_interfaces.sh
#sh render_interfaces.sh
cat /tmp/interfaces > /target/etc/network/interfaces
